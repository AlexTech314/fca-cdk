# Development Dockerfile with hot reload
# Build context: src/ (not src/api/)
FROM node:24-slim

WORKDIR /app

# Install OpenSSL and bash (required for Prisma on Debian slim)
RUN apt-get update && apt-get install -y openssl bash && rm -rf /var/lib/apt/lists/*

# Install ts-node globally for seed script
RUN npm install -g ts-node typescript

# Install db package
COPY packages/db/package*.json ./packages/db/
RUN cd packages/db && npm ci
COPY packages/db/prisma ./packages/db/prisma/
RUN cd packages/db && npx prisma generate
COPY packages/db/src ./packages/db/src/
COPY packages/db/tsconfig.json ./packages/db/
RUN cd packages/db && npx tsc

# Install API dependencies
COPY api/package*.json ./api/
RUN cd api && npm ci

# Copy API source (will be overwritten by volume mount for hot reload)
COPY api/ ./api/

WORKDIR /app/api

EXPOSE 3000

CMD ["npx", "ts-node-dev", "--respawn", "--transpile-only", "src/index.ts"]
