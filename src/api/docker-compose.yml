# FCA API Docker Compose - Development
#
# Prerequisites:
#   cd ../packages/db && docker compose up -d    # Start PostgreSQL
#   cd ../packages/db && npx prisma migrate dev  # Run migrations
#   cd ../packages/db && npx prisma db seed      # Seed data
#
# Usage:
#   docker compose up        - Start API and Cognito Local
#   docker compose down      - Stop services
#
# Or run natively (preferred for hot reload):
#   npm run dev
#
# Database: started separately via packages/db/docker-compose.yml
# Cognito Local: http://localhost:9229
#
services:
  api:
    build:
      context: ..
      dockerfile: api/Dockerfile.dev
    ports:
      - "4000:3000"
    volumes:
      - ./src:/app/api/src
      - /app/api/node_modules
    env_file:
      - .env.local
    depends_on:
      cognito:
        condition: service_started
    restart: unless-stopped

  cognito:
    image: jagregory/cognito-local:latest
    ports:
      - "9229:9229"
    volumes:
      - cognito_data:/app/.cognito
    restart: unless-stopped

volumes:
  cognito_data:
