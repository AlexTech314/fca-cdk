# FCA Next.js Docker Compose
#
# Usage:
#   docker compose up                    - Start both public and admin containers
#   docker compose up web                - Start public container only
#   docker compose up web-admin          - Start admin container only
#   docker compose up web-dev            - Start public dev server with hot reload
#   docker compose up web-admin-dev      - Start admin dev server with hot reload
#   docker compose build --no-cache      - Rebuild both images
#   docker compose down                  - Stop all services
#
# Prerequisites:
#   - API must be running (see src/api/docker-compose.yml) on host port 4000
#   - Create .env.public and .env.admin from the templates below if they don't exist
#
services:
  # ── Production ──────────────────────────────────────

  # Public site (no admin routes) -- port 3002
  web:
    build:
      context: .
      dockerfile: Dockerfile.public
    ports:
      - "3002:3000"
    env_file:
      - .env.public
    restart: unless-stopped

  # Admin site (no public routes) -- port 3003
  web-admin:
    build:
      context: .
      dockerfile: Dockerfile.admin
    ports:
      - "3003:3000"
    env_file:
      - .env.admin
    restart: unless-stopped